package utils

import (
	"context"
	"github.com/Miso-Code/buildpacks-ci/cve-notification-app/services"
	"go.mongodb.org/mongo-driver/mongo"
	"os"
)

func GetMongoConnection() (services.MongoLibrary, *mongo.Client, context.Context, error) {
	mongoUri, _ := os.LookupEnv("MONGO_URI")
	if mongoUri == "" {
		mongoUri = "mongodb://localhost:27017"
	}
	mongoLibrary := services.NewMongoLibrary(mongoUri)
	mongoClient, ctx, err := mongoLibrary.GetMongoClient()
	if err != nil {
		return services.MongoLibrary{}, nil, nil, err
	}

	return mongoLibrary, mongoClient, ctx, nil
}
